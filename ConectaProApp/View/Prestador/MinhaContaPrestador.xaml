<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConectaProApp.View.Prestador.MinhaContaPrestador"
             BackgroundColor="#f1f1f1">

    <ScrollView>
        <VerticalStackLayout>

            <!-- Cabeçalho azul -->
            <Grid BackgroundColor="#0f5cc2" HeightRequest="58" Padding="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Image Source="conectapro_logo.png" HeightRequest="40" VerticalOptions="Center" Grid.Column="0" />


                <Frame HeightRequest="40" WidthRequest="40"
        CornerRadius="20"
        HasShadow="False"
        Padding="0"
        BackgroundColor="White"
        BorderColor="#0f5cc2"
        VerticalOptions="Center"
        HorizontalOptions="End"
        Grid.Column="2">
                    <Image Source="{Binding FotoPrestadorUrl}" 
            Aspect="AspectFill" 
            HeightRequest="40" WidthRequest="40"
            >
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFotoPrestadorClicked"/>
                        </Image.GestureRecognizers>
                        <Image.Clip>
                            <EllipseGeometry 
                 Center="20,20"
                 RadiusX="20"
                 RadiusY="20"/>
                        </Image.Clip>
                    </Image>
                </Frame>
            </Grid>
            
            

            <!-- Imagem de fundo com gesto -->
            <ContentView   Margin="0,0,0,0">
                <ContentView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnHeaderPrestadorTapped" />
                </ContentView.GestureRecognizers>
                <Image x:Name="HeaderPrestadorImage"
                       Source="{Binding FotoVM.FonteImagem}"
                       Aspect="AspectFill"
                       HeightRequest="180"
                       Margin="0,0,0,0"/>
            </ContentView>

            <!-- Avatar centralizado -->
            <Grid Margin="0,-60,0,0">
                <Frame WidthRequest="120" HeightRequest="120"
                       CornerRadius="60"
                       BackgroundColor="White"
                       IsClippedToBounds="True"
                       BorderColor="#eeeeee"
                       HorizontalOptions="Center">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding FotoVM.SelecionarFotoCommand}" />
                    </Frame.GestureRecognizers>
                    <Image x:Name="avatarPrestadorImage"
                           Source="{Binding FotoVM.FonteImagem}"
                           Aspect="AspectFill"
                           WidthRequest="120"
                           HeightRequest="120">
                        <Image.Clip>
                            <EllipseGeometry Center="60,60" RadiusX="60" RadiusY="60"/>
                        </Image.Clip>
                    </Image>
                </Frame>
            </Grid>

            <!-- Nome e descrição editáveis -->
            <VerticalStackLayout Padding="20,0" Spacing="8" HorizontalOptions="Center">
                <Entry x:Name="NomeEntry"
                       Text="{Binding NomePrestador}"
                       FontAttributes="Bold"
                       FontSize="20"
                       WidthRequest="250"
                       HorizontalTextAlignment="Center"
                       TextColor="Black"
                       Placeholder="Seu nome"
                       TextChanged="OnNomeChanged"/>

                <Editor x:Name="DescricaoEditor"
                        Text="{Binding DescricaoPrestador}"
                        FontSize="14"
                        WidthRequest="300"
                        AutoSize="TextChanges"
                        TextColor="Black"
                        Placeholder="Fale um pouco sobre você"
                        HorizontalOptions="Center"
                        TextChanged="OnDescricaoChanged"/>
            </VerticalStackLayout>

            <!-- Abas -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="18" Padding="10">
                <Button Text="Serviços" BackgroundColor="#0f5cc2" TextColor="White"
                        CornerRadius="20" WidthRequest="110"
                        Command="{Binding SelecionarAbaCommand}" CommandParameter="ServicosPrestador" />
                <Button Text="Candidaturas" BackgroundColor="#0f5cc2" TextColor="White"
                        CornerRadius="20" WidthRequest="110"
                        Command="{Binding SelecionarAbaCommand}" CommandParameter="CandidaturasPrestador" />
                <Button Text="Propostas" BackgroundColor="#0f5cc2" TextColor="White"
                        CornerRadius="20" WidthRequest="110"
                        Command="{Binding SelecionarAbaCommand}" CommandParameter="PropostasPrestador" />
            </HorizontalStackLayout>

            <!-- Coleções -->
            <CollectionView ItemsSource="{Binding ServicosAtivosPrestador}"
                            Margin="15,10"
                            IsVisible="{Binding ServicosPrestadorVisivel}" />

            <CollectionView ItemsSource="{Binding SolicitacoesRecebidas}"
                            Margin="15,10"
                            IsVisible="{Binding CandidaturasPrestadorVisivel}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="10" BorderColor="Gray" Padding="10" Margin="0,5">
                            <VerticalStackLayout>
                                <Label Text="{Binding Descricao}" FontAttributes="Bold" FontSize="16" />
                                <Label Text="{Binding ValorProposto, StringFormat='Valor: R$ {0:F2}'}" FontSize="14" />
                                <HorizontalStackLayout HorizontalOptions="End">
                                    <Button Text="ACEITAR"
                                            Command="{Binding AceitarSolicitacaoCommand}"
                                            CommandParameter="{Binding IdSolicitacao}" />
                                    <Button Text="RECUSAR"
                                            Command="{Binding RecusarSolicitacaoCommand}"
                                            CommandParameter="{Binding IdSolicitacao}" />
                                </HorizontalStackLayout>
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <CollectionView ItemsSource="{Binding PropostasPrestador}"
                            Margin="15,10"
                            IsVisible="{Binding PropostasPrestadorVisivel}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="10" BorderColor="Gray" Padding="10" Margin="0,5">
                            <VerticalStackLayout>
                                <Label Text="{Binding Descricao}" FontAttributes="Bold" FontSize="16" />
                                <Label Text="{Binding ValorProposto, StringFormat='Valor: R$ {0:F2}'}" FontSize="14" />
                                <Button Text="Reofertar"
                                        Command="{Binding ReofertarSolicitacaoCommand}"
                                        CommandParameter="{Binding IdSolicitacao}"
                                        HorizontalOptions="End" />
                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
