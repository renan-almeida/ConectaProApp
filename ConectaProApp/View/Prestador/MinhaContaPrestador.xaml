<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ConectaProApp.View.Prestador.MinhaContaPrestador"
             BackgroundColor="#f1f1f1">

    <ScrollView>
        <VerticalStackLayout>

            <!-- Cabeçalho azul -->
            <Grid BackgroundColor="Black" HeightRequest="58" Padding="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Image Source="conectapro_logo.png" HeightRequest="40" VerticalOptions="Center" Grid.Column="0" />


                <Frame HeightRequest="40" WidthRequest="40"
        CornerRadius="20"
        HasShadow="False"
        Padding="0"
        BackgroundColor="White"
        BorderColor="#0f5cc2"
        VerticalOptions="Center"
        HorizontalOptions="End"
        Grid.Column="2">
                    <Image Source="prestadorsemfoto.png" 
            Aspect="AspectFill" 
            HeightRequest="40" WidthRequest="40"
            >
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Tapped="OnFotoPrestadorClicked"/>
                        </Image.GestureRecognizers>
                        <Image.Clip>
                            <EllipseGeometry 
                 Center="20,20"
                 RadiusX="20"
                 RadiusY="20"/>
                        </Image.Clip>
                    </Image>
                </Frame>
            </Grid>
            
            

            <!-- Imagem de fundo com gesto -->
            <ContentView   Margin="0,0,0,0">
                <ContentView.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnHeaderPrestadorTapped" />
                </ContentView.GestureRecognizers>
                <Image x:Name="HeaderPrestadorImage"
                       Source="{Binding FotoVM.FonteImagem}"
                       Aspect="AspectFill"
                       HeightRequest="180"
                       Margin="0,0,0,0"/>
            </ContentView>

            <!-- Avatar centralizado -->
            <Grid Margin="0,-60,0,0">
                <Frame WidthRequest="120" HeightRequest="120"
                       CornerRadius="60"
                       BackgroundColor="White"
                       IsClippedToBounds="True"
                       BorderColor="#0f5cc2"
                       HorizontalOptions="Center">
                    <Frame.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding FotoVM.SelecionarFotoCommand}" />
                    </Frame.GestureRecognizers>
                    <Image x:Name="avatarPrestadorImage"
                           Source="prestadorsemfoto.png"
                           Aspect="AspectFill"
                           WidthRequest="120"
                           HeightRequest="120">
                        <Image.Clip>
                            <EllipseGeometry Center="60,60" RadiusX="60" RadiusY="60"/>
                        </Image.Clip>
                    </Image>
                </Frame>
            </Grid>

            <!-- Nome e descrição editáveis -->
            <VerticalStackLayout Padding="20,0" Spacing="8" HorizontalOptions="Center">
                <Label Text="{Binding NomePrestador, Mode=OneWay}"
                       FontAttributes="Bold"
                       FontSize="20"
                       HorizontalTextAlignment="Center"
                       TextColor="Black" />

                <Label Text="{Binding DescricaoPrestador, Mode=OneWay}"
                       FontSize="14"
                       HorizontalTextAlignment="Center"
                       TextColor="Black" />

            </VerticalStackLayout>

            <!-- Abas -->
            <HorizontalStackLayout HorizontalOptions="Center" Spacing="18" Padding="10">
                <Button Text="Serviços" BackgroundColor="#0f5cc2" TextColor="White"
            CornerRadius="20" WidthRequest="110"
            Command="{Binding SelecionarAbaCommand}" CommandParameter="ServicosPrestador" />
                <Button Text="Candidaturas" BackgroundColor="#0f5cc2" TextColor="White"
            CornerRadius="20" WidthRequest="110"
            Command="{Binding SelecionarAbaCommand}" CommandParameter="CandidaturasPrestador" />
                <Button Text="Propostas" BackgroundColor="#0f5cc2" TextColor="White"
            CornerRadius="20" WidthRequest="110"
            Command="{Binding SelecionarAbaCommand}" CommandParameter="PropostasPrestador" />
            </HorizontalStackLayout>

            <!-- PropostasRecebidas -->
            <CollectionView x:Name="PropostasPrestadorView"
                ItemsSource="{Binding PropostasRecebidasPrestador}"
                Margin="15,10"
                IsVisible="{Binding PropostasPrestadorVisivel}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="10" BorderColor="Gray" Padding="10" Margin="0,5" BackgroundColor="White">
                            <VerticalStackLayout Spacing="10" Padding="10,5,10,5">

                                <!-- Título -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="{Binding TituloServico}" 
                               FontAttributes="Bold" 
                               FontSize="16" 
                               TextColor="Black"
                               VerticalOptions="Center"
                               Margin="5,0,10,0"/>
                                    
                                </Grid>

                                <!-- Urgência e Forma de Pagamento -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding NvlUrgenciaEnum}" 
                               FontSize="12" 
                               TextColor="Blue"
                               VerticalOptions="Center"
                               Margin="5,0,0,0"/>
                                    <Label Text="{Binding StatusAmigavel}" FontSize="12" TextColor="Orange" Margin="5,50,0,0" />
                                    <Label Text="{Binding FormaPagtoEnum}" 
                               FontSize="12" 
                               TextColor="Black" 
                               HorizontalOptions="End"
                               VerticalOptions="Center"/>
                                </Grid>

                                <!-- Valor e Datas -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding ValorContratacao, StringFormat='VALOR: R$ {0:N2}'}" 
                               FontSize="12" 
                               TextColor="Black"
                               VerticalOptions="Center"
                               Margin="0,0,10,50"/>
                                    <Label Text="{Binding PrevisaoInicio, StringFormat='DATA INICIO: {0}'}" 
                               FontSize="12" 
                               TextColor="Black" 
                               HorizontalOptions="End"
                               VerticalOptions="Center"/>

                                    
                                </Grid>

                                <!-- Cliente -->
                                <Label Text="{Binding EmpresaClienteResumoDTO.NomeFantasia, StringFormat='CLIENTE: {0}'}" 
                           FontSize="12" 
                           TextColor="Black"
                           VerticalOptions="Center"
                           Margin="5,0,0,0"/>

                                <!-- Botões -->
                                <HorizontalStackLayout HorizontalOptions="End" Spacing="20">
                                    <Button Text="ACEITAR"
                                BackgroundColor="White"
                                BorderColor="Green"
                                TextColor="Green"
                                BorderWidth="1"
                                Command="{Binding BindingContext.AceitarSolicitacaoCommand, Source={x:Reference PropostasPrestadorView}}"
                                CommandParameter="{Binding IdSolicitacao}" />

                                    <Button Text="RECUSAR"
                                BackgroundColor="White"
                                BorderColor="Red"
                                TextColor="Red"
                                BorderWidth="1"
                                Command="{Binding BindingContext.RecusarSolicitacaoCommand, Source={x:Reference PropostasPrestadorView}}"
                                CommandParameter="{Binding IdSolicitacao}" />
                                </HorizontalStackLayout>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>




            <!-- Lista de candidaturas -->
            <CollectionView x:Name="CandidaturasView"
                ItemsSource="{Binding CandidaturasPrestador}"
                Margin="15,10"
                IsVisible="{Binding CandidaturasPrestadorVisivel}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="10" BorderColor="Gray" Padding="10" Margin="0,5" BackgroundColor="White">
                            <VerticalStackLayout Spacing="5">

                                <!-- Título -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="{Binding TituloServico}" FontAttributes="Bold" FontSize="16" TextColor="Black" />
                                   
                                </Grid>

                                <!-- Status e Forma de Pagamento -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding StatusAmigavel}" FontSize="12" TextColor="Orange" />
                                    <Label Text="{Binding FormaPagtoEnum}" FontSize="12" TextColor="Black" HorizontalOptions="End" />
                                </Grid>

                                <!-- Valor e Data Início -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding ValorContratacao, StringFormat='VALOR: R$ {0:N2}'}" FontSize="12" TextColor="Black" Margin="0,20,50,0" />
                                    <Label Text="{Binding PrevisaoInicio, StringFormat='DATA INICIO: {0}'}" FontSize="12" TextColor="Black" HorizontalOptions="End" />
                                </Grid>

                                <!-- Cliente e Data Fim -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding EmpresaClienteResumoDTO.NomeFantasia, StringFormat='CLIENTE: {0}'}" FontSize="12" TextColor="Black" />
                                    
                                </Grid>

                                <!-- Botão de cancelar -->
                                <HorizontalStackLayout HorizontalOptions="End">
                                    <Button Text="CANCELAR"
                                BackgroundColor="White"
                                BorderColor="Red"
                                TextColor="Red"
                                BorderWidth="1"
                                Command="{Binding BindingContext.CancelarCandidaturaCommand, Source={x:Reference CandidaturasView}}"
                                CommandParameter="{Binding IdServico}" />
                                </HorizontalStackLayout>

                                <Button Text="REOFERTAR"
                                BackgroundColor="White"
                                BorderColor="Orange"
                                TextColor="Orange"
                                BorderWidth="1"
                                Command="{Binding BindingContext.ReofertarServicoCommand, Source={x:Reference CandidaturasView}}"
                                CommandParameter="{Binding IdServico}" />

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>


            <!-- Lista de Serviços -->
            <CollectionView x:Name="ServicosView"
                ItemsSource="{Binding ServicosPrestador}"
                Margin="15,10"
                IsVisible="{Binding ServicosPrestadorVisivel}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="10" BorderColor="Gray" Padding="10" Margin="0,5" BackgroundColor="White">
                            <VerticalStackLayout Spacing="5">

                                <!-- Título com bolinha -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Text="{Binding TituloServico}" FontAttributes="Bold" FontSize="16" TextColor="Black" />
                                   
                                </Grid>

                                <!-- Status e Urgência -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding StatusAmigavel, Converter={StaticResource StatusServicoConverter}}" FontSize="12" TextColor="Orange" />
                                    <Label Text="{Binding NvlUrgenciaEnum, Converter={StaticResource UrgenciaConverter}}" FontSize="12" TextColor="Blue" HorizontalOptions="End"/>
                                </Grid>

                                <!-- Valor e Categoria -->
                                <Grid ColumnDefinitions="*,*">
                                    <Label Text="{Binding ValorContratacao, StringFormat='VALOR: R$ {0:N2}'}" FontSize="12" TextColor="Black" />
                                    <Label Text="{Binding TipoCategoriaEnum, Converter={StaticResource CategoriaConverter}}" FontSize="12" TextColor="Black" HorizontalOptions="End" Margin="0,15,90,0" />
                                </Grid>

                                <!-- Cliente -->
                                <Label Text="{Binding EmpresaClienteResumoDTO.NomeFantasia, StringFormat='CLIENTE: {0}'}" FontSize="12" TextColor="Black" />

                                <!-- Botão Finalizar -->
                                <HorizontalStackLayout HorizontalOptions="End">
                                    <Button Text="FINALIZAR"
                                BackgroundColor="White"
                                BorderColor="Green"
                                TextColor="Green"
                                BorderWidth="1"
                                Command="{Binding BindingContext.FinalizarServicoCommand, Source={x:Reference ServicosView}}"
                                CommandParameter="{Binding IdServico}" />
                                </HorizontalStackLayout>

                            </VerticalStackLayout>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>


        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
